---
title: "sql_md"
output: github_document
parent: sql
nav_order: 1
---

---
layout: default
title: SQL â€“ Applied
parent: SQL
nav_order: 1
---

```{r setup, include=FALSE}
rm(list = ls(all = TRUE))
#knitr::opts_knit$set(root.dir = here::here())
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  results = "asis"
)
options(knitr.table.format = "markdown")
```

```{r}
install.packages(
  setdiff(
    c("DBI", "duckdb", "nycflights13", "tidyverse", "here"),
    rownames(installed.packages())
  )
)
```

```{r}
library(here)
library(DBI)
library(duckdb)
library(nycflights13)
library(tidyverse)
```

```{r}
# GitHub raw link for the DuckDB database file
url <- "https://github.com/AU-datascience/data/raw/main/413-613/flights.duckdb"

# Local path to save the file
dest <- here("sql", "flights.duckdb")

# Download the file
download.file(url, dest, mode = "wb")
```

```{r}
con <- dbConnect(duckdb(dbdir = "./flights.duckdb"))
class(con)
#dbDisconnect(con_p)
```

```{r}
res <- dbGetQuery(con, "
  SHOW TABLES;
")
knitr::kable(res)
```

```{r}
res <- dbGetQuery(con, "
  DESCRIBE;
")
knitr::kable(res)
```

```{r}
res <- dbGetQuery(con, "
  DESCRIBE airlines;
")
knitr::kable(res)
```

```{sql, connection=con}
#| label: lst-show-tables
SHOW TABLES;
```
```{sql, connection=con}
#| label: lst-des-tables
DESCRIBE airlines;
```

```{sql}
#| connection: con
#| label: lst-select-planes
SELECT "tailnum", "year", "model" 
FROM planes;
```

```{sql}
#| connection: con
#| label: lst-select-planes-2
SELECT * 
FROM planes
LIMIT 5;
```

```{sql}
#| connection: con
SELECT DISTINCT "dest" 
FROM flights;
```

```{sql}
#| connection: con
SELECT "flight", "distance", "origin", "dest" 
FROM flights
WHERE "distance" < 50;
```

```{sql}
#| connection: con
SELECT "flight", "month" 
FROM flights
WHERE "month" = 12;
```

```{sql}
#| connection: con
SELECT "flight", "origin" 
FROM flights
WHERE "origin" = 'JFK';
```

```{sql}
#| connection: con
SELECT "flight", "origin", "dest" 
FROM flights
WHERE "origin" = 'JFK' AND "dest" = 'CMH';
```

```{sql}
#| connection: con
SELECT
    DISTINCT "flight",
    "origin",
    "dest"
FROM
    flights
WHERE
    NOT ("origin" = 'JFK'
        OR "origin" = 'LGA')
    AND dest = 'CMH';
```

```{sql}
#| connection: con
SELECT DISTINCT
    "flight",
    "origin",
    "dest"
FROM flights
WHERE
    "origin" NOT IN ('JFK', 'LGA')
    AND "dest" IN ('BWI', 'IAD', 'DCA');
```

```{sql}
#| connection: con
SELECT "flight", "dep_delay" 
FROM flights
WHERE "dep_delay" IS NOT NULL;
```

```{sql}
#| connection: con
SELECT "flight", "dep_delay" 
FROM flights
WHERE "dep_delay" IS NULL;
```







